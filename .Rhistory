LA_receipts_row = 42,
con_overall_row = 46,
cons_eld_dis_row = 47,
cons_young_row = 48,
other_revenue_row = 53,
total_op_costs_row = 65,
fixed_costs_row = 67,
semi_fixed_costs_row = 68,
variable_costs_row = 69,
changes_to_fleet_row = 16,
basis_row = 27,
pass_source_details_row = 46,
costs_source_details_row = 73,
comments_row = 79,
last_year_col = 3,
this_year_col = 5,
text_col = 1)
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
cells <- list(no_of_vehicles_row = 13,
no_of_stops_row = 15,
route_km_row = 16,
km_operated_row = 24,
total_boardings_row = 31,
cons_boardings_row = 32,
cons_boarding_eld_dis_row = 33,
cons_boarding_young_row = 34,
passenger_km_row = 35,
passenger_receipts_row = 38,
LA_receipts_row = 42,
con_overall_row = 46,
cons_eld_dis_row = 47,
cons_young_row = 48,
other_revenue_row = 53,
total_op_costs_row = 65,
fixed_costs_row = 67,
semi_fixed_costs_row = 68,
variable_costs_row = 69,
changes_to_fleet_row = 16,
basis_row = 27,
pass_source_details_row = 46,
costs_source_details_row = 73,
comments_row = 79,
last_year_col = 3,
this_year_col = 5,
text_col = 1)
read_lrt_file <- function(survey_path){
# Read survey form
survey_form = readxl::read_excel(survey_path)
# Extract operator name from survey form
operator_name <- stringr::str_to_title(survey_form[[1, 1]])
# Extract data from survey form
xl_data <- tibble::tibble(
name               = c(operator_name, operator_name),
year               = c("this_year", "last_year"),
no_of_vehicles     = c(survey_form[[cells$no_of_vehicles_row,
cells$this_year_col]],
survey_form[[cells$no_of_vehicles_row,
cells$last_year_col]]),
no_of_stops        = c(survey_form[[cells$no_of_stops_row,
cells$this_year_col]],
survey_form[[cells$no_of_stops_row,
cells$last_year_col]]),
route_km           = c(survey_form[[cells$route_km_row,
cells$this_year_col]],
survey_form[[cells$route_km_row,
cells$last_year_col]]),
km_operated        = c(survey_form[[cells$km_operated_row,
cells$this_year_col]],
survey_form[[cells$km_operated_row,
cells$last_year_col]]),
total_boardings    = c(survey_form[[cells$total_boardings_row,
cells$this_year_col]],
survey_form[[cells$total_boardings_row,
cells$last_year_col]]),
cons_boardings     = c(survey_form[[cells$cons_boardings_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_row,
cells$last_year_col]]),
cons_boardings_eld_dis = c(survey_form[[cells$cons_boardings_eld_dis_row,
cells$this_year_col]],
NA),
cons_boardings_young     = c(survey_form[[cells$cons_boardings_young_row,
cells$this_year_col]],
NA),
passenger_km       = c(survey_form[[cells$passenger_km_row,
cells$this_year_col]],
survey_form[[cells$passenger_km_row,
cells$last_year_col]]),
passenger_receipts = c(survey_form[[cells$passenger_receipts_row,
cells$this_year_col]],
NA),
LA_receipts = c(survey_form[[cells$LA_receipts_row,
cells$this_year_col]],
NA),
cons_overall       = c(survey_form[[cells$cons_overall_row,
cells$this_year_col]],
survey_form[[cells$cons_overall_row,
cells$last_year_col]]),
cons_eld_dis       = c(survey_form[[cells$cons_eld_dis_row,
cells$this_year_col]],
survey_form[[cells$cons_eld_dis_row,
cells$last_year_col]]),
cons_young         = c(survey_form[[cells$cons_young_row,
cells$this_year_col]],
survey_form[[cells$cons_young_row,
cells$last_year_col]]),
other_revenue         = c(survey_form[[cells$other_revenue_row,
cells$this_year_col]],
NA),
total_op_costs        = c(survey_form[[cells$total_op_costs_row,
cells$this_year_col]],
NA),
fixed_costs        = c(survey_form[[cells$fixed_costs_row,
cells$this_year_col]],
NA),
semi_fixed_costs        = c(survey_form[[cells$semi_fixed_costs_row,
cells$this_year_col]],
NA),
variable_costs        = c(survey_form[[cells$variable_costs_row,
cells$this_year_col]],
NA),
basis              = c(survey_form[[cells$basis_row,
cells$text_col]],
NA),
pass_source_details     = c(survey_form[[cells$pass_source_details_row,
cells$text_col]],
NA),
costs_source_details     = c(survey_form[[cells$costs_source_details_row,
cells$text_col]],
NA),
comments           = c(survey_form[[cells$comments_row,
cells$text_col]],
NA)
)
}
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
read_lrt_file <- function(survey_path){
# Read survey form
survey_form = readxl::read_excel(survey_path)
# Extract operator name from survey form
operator_name <- stringr::str_to_title(survey_form[[1, 1]])
# Extract data from survey form
xl_data <- tibble::tibble(
name               = c(operator_name, operator_name),
year               = c("this_year", "last_year"),
no_of_vehicles     = c(survey_form[[cells$no_of_vehicles_row,
cells$this_year_col]],
survey_form[[cells$no_of_vehicles_row,
cells$last_year_col]]),
no_of_stops        = c(survey_form[[cells$no_of_stops_row,
cells$this_year_col]],
survey_form[[cells$no_of_stops_row,
cells$last_year_col]]),
route_km           = c(survey_form[[cells$route_km_row,
cells$this_year_col]],
survey_form[[cells$route_km_row,
cells$last_year_col]]),
km_operated        = c(survey_form[[cells$km_operated_row,
cells$this_year_col]],
survey_form[[cells$km_operated_row,
cells$last_year_col]]),
total_boardings    = c(survey_form[[cells$total_boardings_row,
cells$this_year_col]],
survey_form[[cells$total_boardings_row,
cells$last_year_col]]),
cons_boardings     = c(survey_form[[cells$cons_boardings_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_row,
cells$last_year_col]]),
cons_boardings_eld_dis = c(survey_form[[cells$cons_boardings_eld_dis_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_eld_dis_row,
cells$last_year_col]]),
cons_boardings_young     = c(survey_form[[cells$cons_boardings_young_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_young_row,
cells$last_year_col]]),
passenger_km       = c(survey_form[[cells$passenger_km_row,
cells$this_year_col]],
survey_form[[cells$passenger_km_row,
cells$last_year_col]]),
passenger_receipts = c(survey_form[[cells$passenger_receipts_row,
cells$this_year_col]],
survey_form[[cells$passenger_receipts_row,
cells$last_year_col]]),
LA_receipts = c(survey_form[[cells$LA_receipts_row,
cells$this_year_col]],
survey_form[[cells$LA_receipts_row,
cells$last_year_col]]),
cons_overall       = c(survey_form[[cells$cons_overall_row,
cells$this_year_col]],
survey_form[[cells$cons_overall_row,
cells$last_year_col]]),
cons_eld_dis       = c(survey_form[[cells$cons_eld_dis_row,
cells$this_year_col]],
survey_form[[cells$cons_eld_dis_row,
cells$last_year_col]]),
cons_young         = c(survey_form[[cells$cons_young_row,
cells$this_year_col]],
survey_form[[cells$cons_young_row,
cells$last_year_col]]),
other_revenue         = c(survey_form[[cells$other_revenue_row,
cells$this_year_col]],
survey_form[[cells$other_revenue_row,
cells$last_year_col]]),
total_op_costs        = c(survey_form[[cells$total_op_costs_row,
cells$this_year_col]],
survey_form[[cells$total_op_costs_row,
cells$last_year_col]]),
fixed_costs        = c(survey_form[[cells$fixed_costs_row,
cells$this_year_col]],
survey_form[[cells$fixed_costs_row,
cells$last_year_col]]),
semi_fixed_costs        = c(survey_form[[cells$semi_fixed_costs_row,
cells$this_year_col]],
survey_form[[cells$semi_fixed_costs_row,
cells$last_year_col]]),
variable_costs        = c(survey_form[[cells$variable_costs_row,
cells$this_year_col]],
survey_form[[cells$variable_costs_row,
cells$last_year_col]]),
basis              = c(survey_form[[cells$basis_row,
cells$text_col]]
),
pass_source_details     = c(survey_form[[cells$pass_source_details_row,
cells$text_col]]
),
costs_source_details     = c(survey_form[[cells$costs_source_details_row,
cells$text_col]]
),
comments           = c(survey_form[[cells$comments_row,
cells$text_col]]
)
)
}
#' Reads all Light Rail and Tram survey forms in folder
#'
#' This function loops through a folder with the light rail and tram survey forms in
#' and returns a tibble containing the data from each survey form.
#'
#' @param survey_folder_path is a string containing the path of the surveys folder. This folder
#' must contain the survey forms and nothing else. The path should not end with slashes. For Windows
#' paths, each backslash must be changed to either a forward slash "/" or two backslashes "\\\\".
#'
#' @return A 2dx17 tibble (where d is the number of survey responses in the folder) containing all
#' the data entries in each survey form. This does not include the contact details.
#'
#' @examples
#' read_lrt_folder("G:/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2020/5. RAP Data/Received Survey forms")
#'
read_lrt_folder <- function(survey_folder_path){
files <- dir(survey_folder_path, pattern = ".xlsx")
full_data <- NULL
for (i in 1:length(files)){
single_data <- read_lrt_file(paste(survey_folder_path, files[i], sep = "/"))
full_data <- dplyr::bind_rows(full_data, single_data)
}
return(full_data)
}
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
View(cells)
cells$cons_boarding_eld_dis_row
survey_form = readxl::read_excel(survey_path)
survey_path <- "//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx"
survey_form = readxl::read_excel(survey_path)
survey_form[[cells$cons_boardings_eld_dis_row,
cells$this_year_col]]
survey_form[[cells$cons_boardings_row,
cells$this_year_col]]
survey_form[[33, 5]]
View(survey_form)
View(survey_form)
write.csv(survey_form,"//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAl/\STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/test_form.csv")
write.csv(survey_form,"//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAl/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/test_form.csv")
cells <- list(no_of_vehicles_row = 10,
no_of_stops_row = 12,
route_km_row = 13,
km_operated_row = 21,
total_boardings_row = 28,
cons_boardings_row = 29,
cons_boarding_eld_dis_row = 30,
cons_boarding_young_row = 31,
passenger_km_row = 32,
passenger_receipts_row = 35,
LA_receipts_row = 39,
con_overall_row = 43,
cons_eld_dis_row = 44,
cons_young_row = 45,
other_revenue_row = 50,
total_op_costs_row = 62,
fixed_costs_row = 64,
semi_fixed_costs_row = 65,
variable_costs_row = 66,
changes_to_fleet_row = 16,
basis_row = 23,
pass_source_details_row = 54,
costs_source_details_row = 70,
comments_row = 76,
last_year_col = 3,
this_year_col = 5,
text_col = 1)
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
survey_form[[30,3]]
survey_form[[30,5]]
survey_path <- "//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx"
> survey_form = readxl::read_excel(survey_path)
survey_path <- "//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx"
survey_form = readxl::read_excel(survey_path)
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
survey_form[[30,3]]
str(survey_form)
head(survey_form)
View(raw_xl)
read_lrt_file <- function(survey_path){
# Read survey form
survey_form = readxl::read_excel(survey_path)
# Extract operator name from survey form
operator_name <- stringr::str_to_title(survey_form[[1, 1]])
# Extract data from survey form
xl_data <- data.frame(
name               = c(operator_name, operator_name),
year               = c("this_year", "last_year"),
no_of_vehicles     = c(survey_form[[cells$no_of_vehicles_row,
cells$this_year_col]],
survey_form[[cells$no_of_vehicles_row,
cells$last_year_col]]),
no_of_stops        = c(survey_form[[cells$no_of_stops_row,
cells$this_year_col]],
survey_form[[cells$no_of_stops_row,
cells$last_year_col]]),
route_km           = c(survey_form[[cells$route_km_row,
cells$this_year_col]],
survey_form[[cells$route_km_row,
cells$last_year_col]]),
km_operated        = c(survey_form[[cells$km_operated_row,
cells$this_year_col]],
survey_form[[cells$km_operated_row,
cells$last_year_col]]),
total_boardings    = c(survey_form[[cells$total_boardings_row,
cells$this_year_col]],
survey_form[[cells$total_boardings_row,
cells$last_year_col]]),
cons_boardings     = c(survey_form[[cells$cons_boardings_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_row,
cells$last_year_col]]),
cons_boardings_eld_dis = c(survey_form[[cells$cons_boardings_eld_dis_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_eld_dis_row,
cells$last_year_col]]),
cons_boardings_young     = c(survey_form[[cells$cons_boardings_young_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_young_row,
cells$last_year_col]]),
passenger_km       = c(survey_form[[cells$passenger_km_row,
cells$this_year_col]],
survey_form[[cells$passenger_km_row,
cells$last_year_col]]),
passenger_receipts = c(survey_form[[cells$passenger_receipts_row,
cells$this_year_col]],
survey_form[[cells$passenger_receipts_row,
cells$last_year_col]]),
LA_receipts = c(survey_form[[cells$LA_receipts_row,
cells$this_year_col]],
survey_form[[cells$LA_receipts_row,
cells$last_year_col]]),
cons_overall       = c(survey_form[[cells$cons_overall_row,
cells$this_year_col]],
survey_form[[cells$cons_overall_row,
cells$last_year_col]]),
cons_eld_dis       = c(survey_form[[cells$cons_eld_dis_row,
cells$this_year_col]],
survey_form[[cells$cons_eld_dis_row,
cells$last_year_col]]),
cons_young         = c(survey_form[[cells$cons_young_row,
cells$this_year_col]],
survey_form[[cells$cons_young_row,
cells$last_year_col]]),
other_revenue         = c(survey_form[[cells$other_revenue_row,
cells$this_year_col]],
survey_form[[cells$other_revenue_row,
cells$last_year_col]]),
total_op_costs        = c(survey_form[[cells$total_op_costs_row,
cells$this_year_col]],
survey_form[[cells$total_op_costs_row,
cells$last_year_col]]),
fixed_costs        = c(survey_form[[cells$fixed_costs_row,
cells$this_year_col]],
survey_form[[cells$fixed_costs_row,
cells$last_year_col]]),
semi_fixed_costs        = c(survey_form[[cells$semi_fixed_costs_row,
cells$this_year_col]],
survey_form[[cells$semi_fixed_costs_row,
cells$last_year_col]]),
variable_costs        = c(survey_form[[cells$variable_costs_row,
cells$this_year_col]],
survey_form[[cells$variable_costs_row,
cells$last_year_col]]),
basis              = c(survey_form[[cells$basis_row,
cells$text_col]]
),
pass_source_details     = c(survey_form[[cells$pass_source_details_row,
cells$text_col]]
),
costs_source_details     = c(survey_form[[cells$costs_source_details_row,
cells$text_col]]
),
comments           = c(survey_form[[cells$comments_row,
cells$text_col]]
)
)
}
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
read_lrt_file <- function(survey_path){
# Read survey form
survey_form = readxl::read_excel(survey_path)
# Extract operator name from survey form
operator_name <- stringr::str_to_title(survey_form[[1, 1]])
# Extract data from survey form
xl_data <- tibble::tibble(
name               = c(operator_name, operator_name),
year               = c("this_year", "last_year"),
no_of_vehicles     = c(survey_form[[cells$no_of_vehicles_row,
cells$this_year_col]],
survey_form[[cells$no_of_vehicles_row,
cells$last_year_col]]),
no_of_stops        = c(survey_form[[cells$no_of_stops_row,
cells$this_year_col]],
survey_form[[cells$no_of_stops_row,
cells$last_year_col]]),
route_km           = c(survey_form[[cells$route_km_row,
cells$this_year_col]],
survey_form[[cells$route_km_row,
cells$last_year_col]]),
km_operated        = c(survey_form[[cells$km_operated_row,
cells$this_year_col]],
survey_form[[cells$km_operated_row,
cells$last_year_col]]),
total_boardings    = c(survey_form[[cells$total_boardings_row,
cells$this_year_col]],
survey_form[[cells$total_boardings_row,
cells$last_year_col]]),
cons_boardings     = c(survey_form[[cells$cons_boardings_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_row,
cells$last_year_col]]),
cons_boardings_young     = c(survey_form[[cells$cons_boardings_young_row,
cells$this_year_col]],
survey_form[[cells$cons_boardings_young_row,
cells$last_year_col]]),
passenger_km       = c(survey_form[[cells$passenger_km_row,
cells$this_year_col]],
survey_form[[cells$passenger_km_row,
cells$last_year_col]]),
passenger_receipts = c(survey_form[[cells$passenger_receipts_row,
cells$this_year_col]],
survey_form[[cells$passenger_receipts_row,
cells$last_year_col]]),
LA_receipts = c(survey_form[[cells$LA_receipts_row,
cells$this_year_col]],
survey_form[[cells$LA_receipts_row,
cells$last_year_col]]),
cons_overall       = c(survey_form[[cells$cons_overall_row,
cells$this_year_col]],
survey_form[[cells$cons_overall_row,
cells$last_year_col]]),
cons_eld_dis       = c(survey_form[[cells$cons_eld_dis_row,
cells$this_year_col]],
survey_form[[cells$cons_eld_dis_row,
cells$last_year_col]]),
cons_young         = c(survey_form[[cells$cons_young_row,
cells$this_year_col]],
survey_form[[cells$cons_young_row,
cells$last_year_col]]),
other_revenue         = c(survey_form[[cells$other_revenue_row,
cells$this_year_col]],
survey_form[[cells$other_revenue_row,
cells$last_year_col]]),
total_op_costs        = c(survey_form[[cells$total_op_costs_row,
cells$this_year_col]],
survey_form[[cells$total_op_costs_row,
cells$last_year_col]]),
fixed_costs        = c(survey_form[[cells$fixed_costs_row,
cells$this_year_col]],
survey_form[[cells$fixed_costs_row,
cells$last_year_col]]),
semi_fixed_costs        = c(survey_form[[cells$semi_fixed_costs_row,
cells$this_year_col]],
survey_form[[cells$semi_fixed_costs_row,
cells$last_year_col]]),
variable_costs        = c(survey_form[[cells$variable_costs_row,
cells$this_year_col]],
survey_form[[cells$variable_costs_row,
cells$last_year_col]]),
basis              = c(survey_form[[cells$basis_row,
cells$text_col]]
),
pass_source_details     = c(survey_form[[cells$pass_source_details_row,
cells$text_col]]
),
costs_source_details     = c(survey_form[[cells$costs_source_details_row,
cells$text_col]]
),
comments           = c(survey_form[[cells$comments_row,
cells$text_col]]
)
)
}
read_lrt_file("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
read.csv("//virago.internal.dtlr.gov.uk/Data/AFP/RLTDAll/STS/003 BLT/003 LIGHT RAIL/0001 Data/2022/3. Survey/Validated Survey forms/TEST DO NOT USE.xlsx")
View(cells)
